<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with priors • adoptr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Working with priors">
<meta property="og:description" content="">
<meta property="og:image" content="https://kkmann.github.io/adoptr/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">adoptr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/adoptr.html">Get started</a>
</li>
<li>
  <a href="../articles/working-with-priors.html">Working with priors</a>
</li>
<li>
  <a href="../articles/score-and-constraints-arithmetic.html">Score arithmetic</a>
</li>
<li>
  <a href="../articles/defining-new-scores.html">Defining custom scores</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkmann/adoptr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working with priors</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kkmann/adoptr/blob/master/vignettes/working-with-priors.Rmd"><code>vignettes/working-with-priors.Rmd</code></a></small>
      <div class="hidden name"><code>working-with-priors.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(adoptr)</a></code></pre></div>
<div id="the-usage-of-prior-distributions-in-two-stage-designs" class="section level2">
<h2 class="hasAnchor">
<a href="#the-usage-of-prior-distributions-in-two-stage-designs" class="anchor"></a>The usage of prior distributions in two-stage designs</h2>
<p>A key feature of a clinical trial design is the probability as success. Often this is measured by the power, the probability to reject the null hypothesis when the ‘true’ effect differs from <span class="math inline">\(0\)</span> in a clinically relevant manner.</p>
<p>To decide on which effect size the power should be computed is of high importance. The classical choice is to determine a point alternative hypothesis <span class="math inline">\(\delta = \delta_1\)</span>. However, one may not be sure on the true effect value. This uncertainty can be integrated by the usage of a Bayesian prior distribution <span class="math inline">\(\delta \sim \pi(\delta)\)</span>. In this setting the power can be defined as probability to reject the null hypothesis given that the effect size is at least the minimal clinically relevant one. In order to avoid the incorporation of effect sizes under the null hypothesis, the prior has to be conditioned on the interval <span class="math inline">\([\delta_{MCR}, \infty]\)</span>, where <span class="math inline">\(\delta_{MCR} &gt; 0\)</span> denotes the minimal clinically relevant effect size. <code>adoptr</code> allows the user to use discrete as well as continuous priors and a <code><a href="../reference/Prior-class.html">condition()</a></code> method.</p>
<p>An further advantage of the usage of prior distribution is the possibility to update the prior at the interim analysis and to compute the posterior distribution for, e.g., the calculation of conditional power. <code>adoptr</code> provides the computation of the posterior and uses it automatically for <code>ConditionalPower</code>.</p>
<p>In general, the user of <code>adoptr</code> only needs to define the desired priors for null and alternative hypothesis. Further work on priors is not necessary to obtain an optimal design. Methods for further calcluations as posterior computation are provided but already used internally.</p>
<p>There are two prior classes in <code>adoptr</code> that will be introduced in the following two chapters. For illustration of, e.g. expectation, we will need the following dummy function <span class="math inline">\(f\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="dv">2</span><span class="op">*</span>x</a></code></pre></div>
</div>
<div id="discrete-priors-in-adoptr" class="section level2">
<h2 class="hasAnchor">
<a href="#discrete-priors-in-adoptr" class="anchor"></a>Discrete priors in <code>adoptr</code>
</h2>
<p>The first prior class are classical distrecte priors. The corresponding class in <code>adoptr</code> is named <code>PointMassPrior</code>. It requires the definition of two slots:</p>
<ul>
<li><p><code>theta</code>: the points on which probability mass lies</p></li>
<li><p><code>mass</code>: the respective mass on these points</p></li>
</ul>
<p>Note that <code>theta</code> and <code>mass</code> have to be of the same length and that <code>mass</code> has to sum to one as it defines a probability distribution.</p>
<p>Let us regard an example where the point <span class="math inline">\(\delta = 0.1\)</span> has probability mass <span class="math inline">\(0.4\)</span> and the point <span class="math inline">\(\delta = 0.25\)</span> has mass <span class="math inline">\(1 - 0.4 = 0.6\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">disc_prior &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.25</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>))</a></code></pre></div>
<p>Now, the expectation of <span class="math inline">\(f\)</span> under this prior can be computed via <code><a href="../reference/Prior-class.html">expectation()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/Prior-class.html">expectation</a></span>(disc_prior, f)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; [1] 0.38</span></a></code></pre></div>
<p>The prior can also be conditioned on the interval <span class="math inline">\([0.2, 0.3]\)</span>. Then all probability mass should be concentrated on the single point <span class="math inline">\(\delta =0.25\)</span>. Let us check this.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">disc_prior_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Prior-class.html">condition</a></span>(disc_prior, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">disc_prior_<span class="dv">2</span><span class="op">@</span>theta</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; [1] 0.25</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">disc_prior_<span class="dv">2</span><span class="op">@</span>mass</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; [1] 1</span></a></code></pre></div>
<p>Finally, discrete priors can be updated at the interim and the posterior can be computed. To illustrate this, assume a first-stage sample size <span class="math inline">\(n_1 = 50\)</span> and a first-stage outcome <span class="math inline">\(x_1 = 1\)</span> when the data distribution is normal.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">n1   =<span class="st"> </span><span class="fl">50.0</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">x1   =<span class="st"> </span><span class="fl">1.0</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">dist =<span class="st"> </span><span class="kw"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>()</a></code></pre></div>
<p>Then, the posterior can be computed and regarded.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">disc_post &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Prior-class.html">posterior</a></span>(dist, disc_prior, x1, n1)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">disc_post<span class="op">@</span>theta</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; [1] 0.10 0.25</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">disc_post<span class="op">@</span>mass</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; [1] 0.3777251 0.6222749</span></a></code></pre></div>
<p>Analogously, it can be worked with point mass priors with mass on only one solely point and thereby creating a classical design with power on a point alternative.</p>
<p>However, not only power but all the scores in <code>adoptr</code> as conditional and expected sample size can be computed based on the respective power. This is illustrated in the vignettes to scores.</p>
</div>
<div id="continuous-priors-in-adoptr" class="section level2">
<h2 class="hasAnchor">
<a href="#continuous-priors-in-adoptr" class="anchor"></a>Continuous priors in <code>adoptr</code>
</h2>
<p>Similarily to discrete priors, continuous priors can be used in <code>adoptr</code>. The implemented class is called <code>ContinuousPrior</code> and based on the following slots.</p>
<ul>
<li><p><code>pdf</code>: probability density function of the prior</p></li>
<li><p><code>support</code>: support of the density</p></li>
</ul>
<p>It is important to note that for numerical reasons <code>adoptr</code> does not support infinite support. However, as the density has to integrate to one, its tails need to tend to zero quite quickly and therefore, a finite support should be applicable without loss of generality.</p>
<p>As example a normal prior with mean <span class="math inline">\(\delta = 0.3\)</span>, variance <span class="math inline">\(\tau^2 = 0.04\)</span> and support <span class="math inline">\([-2, 3]\)</span> is presented. Note that if the support was chosen to small (i.e. the integral of the pdf on the support was not numerical one) <code>adoptr</code> would produce an error message.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">dens &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(x, <span class="dt">mean =</span> <span class="fl">0.3</span>, <span class="dt">sd =</span> <span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">cont_prior &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ContinuousPrior-class.html">ContinuousPrior</a></span>(<span class="dt">pdf =</span> dens, <span class="dt">support =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>))</a></code></pre></div>
<p>Computing expectations works equivalently to the discrete case.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/Prior-class.html">expectation</a></span>(cont_prior, f)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; [1] 0.6</span></a></code></pre></div>
<p>Also conditioning works by the same methods. In the continuous case, this is even more important because one does not want to compute power on the full parameter space but only on values of <span class="math inline">\(\delta\)</span> that are greater than zero. This can then also be used to compute scores on the alternative (condition the prior to be greater than zero) or the null hypothesis (condition the prior to be smaller than zero). However, in the particular situation of type one error rate proctection, we recommend the usage of a point mass prior according to the ICH guideline.</p>
<p>Combing back to conditioning, the continuous prior can be conditioned on positive <span class="math inline">\(\delta\)</span>-values and the expectation of <span class="math inline">\(f\)</span> can be computed under this new prior.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">cont_prior_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Prior-class.html">condition</a></span>(cont_prior, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="../reference/Prior-class.html">expectation</a></span>(cont_prior_<span class="dv">2</span>, f)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; [1] 0.6555159</span></a></code></pre></div>
<p>The computation of the posterior distribution also is supported for continuous priors. The example numbers from the discrete example are still used.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">cont_post &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Prior-class.html">posterior</a></span>(dist, cont_prior, x1, n1)</a></code></pre></div>
<p>This is again an object of class <code>ContinuousPrior</code> that can be applied for further use.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-usage-of-prior-distributions-in-two-stage-designs">The usage of prior distributions in two-stage designs</a></li>
      <li><a href="#discrete-priors-in-adoptr">Discrete priors in <code>adoptr</code></a></li>
      <li><a href="#continuous-priors-in-adoptr">Continuous priors in <code>adoptr</code></a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kevin Kunzmann, Maximilian Pilz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'f5b8253ef131d8de31a2e0e075678ba8',
    indexName: 'adoptr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
